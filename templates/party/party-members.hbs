<section
    class='tab {{tabs.partyMembers.cssClass}} {{tabs.partyMembers.id}}'
    data-tab='{{tabs.partyMembers.id}}'
    data-group='{{tabs.partyMembers.group}}'
>

    <div class="party-actions-bar">
        <button class="action-btn primary" data-action="tagTeamRoll">
            <i class="fa-solid fa-user-group"></i>
            <span>Tag Team Roll</span>
        </button>
        <button class="action-btn primary" data-action="groupRoll">
            <i class="fa-solid fa-users"></i>
            <span>Group Roll</span>
        </button>
    </div>

    <fieldset class="resources-overview glassy">
        <legend>{{localize tabs.partyMembers.label}}</legend>
        <div class="resources-grid">
            {{#each document.system.partyMembers as |actor id|}}
            <div class="resource-card inventory-item" data-item-id="{{actor.id}}" data-item-uuid="{{actor.uuid}}" data-type="character" draggable="true">
                <div class="resource-header">
                    <div class="actor-portrait-mini" data-action="editDoc" data-tooltip="#item#{{actor.uuid}}">
                        <img src="{{actor.img}}" alt="{{actor.name}}">
                    </div>
                    <div class="actor-title">
                        <h3 class="actor-name">{{actor.name}}</h3>
                        {{#if (eq actor.type 'adversary')}}
                        <span class="actor-level">{{localize (concat 'DAGGERHEART.GENERAL.Tiers.' actor.system.tier)}}</span>
                        {{else}}
                        <span class="actor-level">{{localize 'DHP.Level'}} {{actor.system.levelData.level.changed}}</span>
                        {{/if}}
                    </div>
                    <div class="controls member-actions-balanced">
                        <a class="collapse-toggle" data-action="toggleCollapse" data-tooltip="Toggle Details">
                            <i class="fa-solid fa-chevron-down"></i>
                        </a>
                        <a data-action="editDoc" data-tooltip="DAGGERHEART.UI.Tooltip.openActorWorld">
                            <i class="fa-solid fa-globe"></i>
                        </a>
                        <a data-action="deletePartyMember" data-tooltip="CONTROLS.CommonDelete">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>

                <div class="resource-body">
                    <div class="resource-bar-section hp">
                        <div class="resource-info">
                            <span class="resource-label">{{localize "DAGGERHEART.GENERAL.HitPoints.short"}}</span>
                            <span class="resource-value">{{actor.system.resources.hitPoints.value}} /
                                {{actor.system.resources.hitPoints.max}}</span>
                        </div>
                        <div class="resource-slots">
                            {{#times actor.system.resources.hitPoints.max}}
                            <span
                                class='resource-slot hp-slot {{#if (gte actor.system.resources.hitPoints.value (add this 1))}}filled{{/if}}'
                                data-action='toggleHitPoints' data-actor-id="{{actor.uuid}}" data-value="{{add this 1}}"
                                data-tooltip="Toggle HP">
                            </span>
                            {{/times}}
                        </div>
                    </div>

                    <div class="resource-bar-section stress">
                        <div class="resource-info">
                            <span class="resource-label">{{localize "DAGGERHEART.GENERAL.stress"}}</span>
                            <span class="resource-value">{{actor.system.resources.stress.value}} /
                                {{actor.system.resources.stress.max}}</span>
                        </div>
                        <div class="resource-slots">
                            {{#times actor.system.resources.stress.max}}
                            <span
                                class='resource-slot stress-slot {{#if (gte actor.system.resources.stress.value (add this 1))}}filled{{/if}}'
                                data-action='toggleStress' data-actor-id="{{actor.uuid}}" data-value="{{add this 1}}"
                                data-tooltip="Toggle Stress">
                            </span>
                            {{/times}}
                        </div>
                    </div>

                    {{#if actor.system.armor.system.marks}}
                    <div class="resource-bar-section armor">
                        <div class="resource-info">
                            <span class="resource-label">{{localize "DAGGERHEART.GENERAL.armorSlots"}}</span>
                            <span class="resource-value">{{actor.system.armor.system.marks.value}} /
                                {{actor.system.armorScore}}</span>
                        </div>
                        <div class="resource-slots armor-slots">
                            {{#times actor.system.armorScore}}
                            <span
                                class='resource-slot armor-slot {{#if (gte actor.system.armor.system.marks.value (add this 1))}}filled{{/if}}'
                                data-action='toggleArmorSlot' data-actor-id="{{actor.uuid}}"
                                data-item-uuid="{{actor.system.armor.uuid}}" data-value="{{add this 1}}"
                                data-tooltip="Toggle Armor">
                                {{#if (gte actor.system.armor.system.marks.value (add this 1))}}
                                <i class="fa-solid fa-shield-halved"></i>
                                {{else}}
                                <i class="fa-solid fa-shield"></i>
                                {{/if}}
                            </span>
                            {{/times}}
                        </div>
                    </div>
                    {{/if}}

                    <div class="resource-footer">
                        <div class="footer-item hope-compact">
                            <span class="footer-label">{{localize "DAGGERHEART.GENERAL.hope"}}</span>
                            <div class="hope-diamonds">
                                {{#times actor.system.resources.hope.max}}
                                <span class='hope-diamond' data-action='toggleHope' data-actor-id="{{actor.uuid}}"
                                    data-value="{{add this 1}}" data-tooltip="Toggle Hope">
                                    {{#if (gte actor.system.resources.hope.value (add this 1))}}
                                    <i class='fa-solid fa-diamond'></i>
                                    {{else}}
                                    <i class='fa-regular fa-circle'></i>
                                    {{/if}}
                                </span>
                                {{/times}}
                            </div>
                        </div>
                        <div class="footer-item thresholds-display">
                            <div class="threshold-values">
                                <span class="threshold-text threshold-clickable" data-action="mark-hp"
                                    data-hp-amount="1" data-actor-id="{{actor.uuid}}">
                                    {{localize "DAGGERHEART.GENERAL.DamageThresholds.mark1HP"}}
                                </span>
                                <div class="resource-group">
                                    <div class="threshold-value-display">
                                        {{actor.system.damageThresholds.major}}
                                    </div>
                                </div>
                                <span class="threshold-text threshold-clickable" data-action="mark-hp"
                                    data-hp-amount="2" data-actor-id="{{actor.uuid}}">
                                    {{localize "DAGGERHEART.GENERAL.DamageThresholds.mark2HP"}}
                                </span>
                                <div class="resource-group">
                                    <div class="threshold-value-display">
                                        {{actor.system.damageThresholds.severe}}
                                    </div>
                                </div>
                                <span class="threshold-text threshold-clickable" data-action="mark-hp"
                                    data-hp-amount="3" data-actor-id="{{actor.uuid}}">
                                    {{localize "DAGGERHEART.GENERAL.DamageThresholds.mark3HP"}}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
                    {{#unless document.system.partyMembers.length}}
            <div class="empty-state-balanced">
                <i class="fa-solid fa-users-slash"></i>
                <span>{{localize "DAGGERHEART.GENERAL.dropActorsHere"}}</span>
            </div>
        {{/unless}}
        </div>
    </fieldset>
</section>